<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Meeting Scheduler</title>
    <link rel="stylesheet" href="/js/meeting.css">
</head>
<body>
    <h1>Available Time Slots</h1>
    <div id="timeSlotsContainer">
        <!-- Display available time slots dynamically -->
        <div class="time-slot" id="timeSlot1" onclick="handleSlotClick(1)">
            <h2>10:00 AM</h2>
            <p id="availableSlots1">Available Slots: 4</p>
        </div>
        <div class="time-slot" id="timeSlot2" onclick="handleSlotClick(2)">
            <h2>11:00 AM</h2>
            <p id="availableSlots2">Available Slots: 4</p>
        </div>
        <div class="time-slot" id="timeSlot3" onclick="handleSlotClick(3)">
            <h2>2:30 PM</h2>
            <p id="availableSlots3">Available Slots: 4</p>
        </div>
        <div class="time-slot" id="timeSlot4" onclick="handleSlotClick(4)">
            <h2>3:00 PM</h2>
            <p id="availableSlots4">Available Slots: 4</p>
        </div>
        <div class="time-slot" id="timeSlot5" onclick="handleSlotClick(5)">
            <h2>5:30 PM</h2>
            <p id="availableSlots5">Available Slots: 4</p>
        </div>
    </div>

    <!-- Booking Form Modal -->
    <div id="bookingFormModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeBookingFormModal()">&times;</span>
            <h2>Book a Slot</h2>
            <form id="bookingForm" action="/api/bookSlot" method="POST" onsubmit="submitBookingForm(event)">
                <label for="name">Name:</label>
                <input type="text" id="name" name="name" required><br><br>
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required><br><br>
                <input type="hidden" id="timeSlotId" name="timeSlotId" value=""><!-- Hidden input for timeSlotId -->
                <button type="submit">Book Slot</button>
            </form>
        </div>
    </div>

    <!-- JavaScript for handling interactions -->
    <script>
        // Function to handle slot click and open booking form modal
        function handleSlotClick(slotId) {
            let availableSlots = document.getElementById(`availableSlots${slotId}`);
            if (availableSlots.innerText.includes('Available')) {
                document.getElementById('timeSlotId').value = slotId;
                document.getElementById('bookingFormModal').style.display = 'block';
            }
        }
    
        // Function to close booking form modal
        function closeBookingFormModal() {
            document.getElementById('bookingFormModal').style.display = 'none';
        }
    
        // Function to generate a random Google Meet ID
        function generateRandomMeetId() {
            let randomId = Math.floor(Math.random() * 1000000); // Generate a random number between 0 to 999999
            return `https://meet.google.com/${randomId}`;
        }
    
        // Function to handle form submission and booking
        async function submitBookingForm(event) {
            event.preventDefault();
            const formData = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                timeSlotId: parseInt(document.getElementById('timeSlotId').value),
                googleMeetId: generateRandomMeetId(), // Use the correct function name
            };
    
            try {
                const response = await fetch('/api/bookSlot', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData),
                });
    
                if (!response.ok) {
                    throw new Error('Failed to book slot');
                }
    
                const result = await response.json();
                console.log('Booking successful:', result);
                
                fetchBookedSlots();  // Ensure this function is defined elsewhere
    
                closeBookingFormModal();
            } catch (error) {
                console.error('Error booking slot:', error.message);
                // Handle error (e.g., show error message to user)
            }
        }
    
        document.getElementById('bookingForm').addEventListener('submit', submitBookingForm);
    </script>
</body>
</html>
